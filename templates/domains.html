{% extends "base.html" %}

{% block title %}Domains Report{% endblock %}

{% block content %}
    <section id="global-recap">
        <h1>üåê Domains Report</h1>
        <div class="card">
            <div class="d-flex d-justify-between">
                <span class="badge {{ 'badge-error' if global_summary.total > 0 else 'badge-success' }}">
                    <strong>{{ global_summary.total }}</strong> {{ global_summary.total | pluralize('vulnerability') }}
                </span>
                <div class="severity-dots">
                    {% for level in severity_order %}
                    <span class="severity-dot">
                        <span class="dot dot-{{ level }}"></span>
                        <span>
                            <strong>{{ global_summary[level] }}</strong>
                            {{ level.capitalize() }}
                        </span>
                    </span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <div class="table">
        <table>
            <thead>
                <tr>
                    <th>Domain</th>
                    <th>Country</th>
                    <th>Status</th>
                    <th>HTTPS</th>
                    <th>Certificate</th>
                    <th>HTTP‚ÜíHTTPS Redirect</th>
                    <th>Expiry</th>
                    <th>Issuer</th>
                    <th>HSTS</th>
                    <th>TLS Versions</th>
                    <th>Open Ports</th>
                    <th>Security Headers</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                    <tr>
                        <td><strong>{{ row.domain }}</strong></td>
                        <td>
                            {{ row.country }}
                        </td>
                        <td>
                            {% if row.active %}
                                <div class="d-flex success">
                                    <span class="dot dot-success"></span>
                                    Active
                                </div>
                            {% else %}
                                <div class="d-flex error">
                                    <span class="dot dot-error"></span>
                                    Inactive
                                </div>
                            {% endif %}
                        </td>
                        <td>
                            {% if row.https_available %}
                                <div class="d-flex success">
                                    <span class="dot dot-success"></span>
                                    Yes
                                </div>
                            {% else %}
                                <div class="d-flex error">
                                    <span class="dot dot-error"></span>
                                    No
                                </div>
                            {% endif %}
                        </td>
                        <td>
                            {% if not row.active or not row.https_available %}
                                -
                            {% else %}
                                {% if row.valid %}
                                    <div class="d-flex success">
                                        <span class="dot dot-success"></span>
                                        Valid
                                    </div>
                                {% else %}
                                    <div class="d-flex error">
                                        <span class="dot dot-error"></span>
                                        Invalid
                                    </div>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            {% if not row.active or not row.https_available %}
                                -
                            {% else %}
                                {% if row.http_to_https_redirect %}
                                    <div class="d-flex success">
                                        <span class="dot dot-success"></span>
                                        Yes
                                    </div>
                                {% else %}
                                    <div class="d-flex error">
                                        <span class="dot dot-error"></span>
                                        No
                                    </div>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td>
                            {{ row.not_after if row.valid else "-" }}<br>
                            {% if row.valid %}
                                ({{ row.days_remaining }} days)
                            {% endif %}
                        </td>
                        <td>
                            {% if row.valid %}
                                {{ row.issuer.values() | join(', ') }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if not row.active or not row.https_available %}
                                -
                            {% else %}
                                {% if row.hsts_present %}
                                    <div class="d-flex success">
                                        <span class="dot dot-success"></span>
                                        Yes
                                    </div>
                                {% else %}
                                    <div class="d-flex error">
                                        <span class="dot dot-error"></span>
                                        No
                                    </div>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="limit-size">
                            {% if row.tls_versions %}
                                <div class="d-flex d-wrap">
                                    {% for version, info in row.tls_versions.items() %}
                                        <span class="badge badge-small {{ 'badge-success' if info.secure else 'badge-error' }}">
                                            {{ version }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </td>
                        <td>
                            {% if not row.active %}
                                -
                            {% else %}
                                {% if row.open_ports %}
                                    {{ row.open_ports | join(', ') }}
                                {% else %}
                                    -
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="limit-size">
                            <div class="d-flex d-wrap">
                                <span title="Helps prevent cross-site scripting and other code injection attacks">
                                    <span class="badge badge-small {{ 'badge-success' if row.csp else 'badge-error' }}">
                                        Content-Security-Policy
                                    </span>
                                </span>
                                <span title="Prevents browsers from MIME-sniffing a response away from the declared content-type">
                                    <span class="badge badge-small {{ 'badge-success' if row.x_content_type_options else 'badge-error' }}">
                                        X-Content-Type-Options
                                    </span>
                                </span>
                                <span title="Protects against clickjacking by controlling whether the site can be framed">
                                    <span class="badge badge-small {{ 'badge-success' if row.x_frame_options else 'badge-error' }}">
                                        X-Frame-Options
                                    </span>
                                </span>
                                <span title="Controls how much referrer information is sent with requests">
                                    <span class="badge badge-small {{ 'badge-success' if row.referrer_policy else 'badge-error' }}">
                                        Referrer-Policy
                                    </span>
                                </span>
                                <span title="Controls which browser features and APIs are allowed to be used on the site">
                                    <span class="badge badge-small {{ 'badge-success' if row.permissions_policy else 'badge-error' }}">
                                        Permissions-Policy
                                    </span>
                                </span>
                                <span title="Prevents cross-origin resources from being loaded without permission (COEP)">
                                    <span class="badge badge-small {{ 'badge-success' if row.coep else 'badge-error' }}">
                                        Cross-Origin-Embedder-Policy
                                    </span>
                                </span>
                                <span title="Opt-in to cross-origin isolation in the browser (COOP)">
                                    <span class="badge badge-small {{ 'badge-success' if row.coop else 'badge-error' }}">
                                        Cross-Origin-Opener-Policy
                                    </span>
                                </span>
                                <span title="Specifies who can load this resource (CORP)">
                                    <span class="badge badge-small {{ 'badge-success' if row.corp else 'badge-error' }}">
                                        Cross-Origin-Resource-Policy
                                    </span>
                                </span>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
